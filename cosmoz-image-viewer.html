<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html" />

<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../cosmoz-behaviors/cosmoz-behaviors.html">
<link rel="import" href="../cosmoz-i18next/cosmoz-i18next.html">

<link rel="import" href="../skeleton-carousel/skeleton-carousel.html">
<link rel="import" href="../img-pan-zoom/img-pan-zoom.html">

<link rel="import" href="cosmoz-image-viewer-overlay.html">

<!--
`cosmoz-image-viewer` is an element for displaying images in a carousel while being able to detach the currently
selected image into another window, zooming and activating a fullscreen mode.

A user can enable the zoom mode by
	a) clicking on the zoom button
	b) double clicking on this element

The zoom mode (+ pan) gets disabled when the image is zoomed out (The initial zoom level is active.) again
so a user can swipe to the next image.

@group Cosmoz Elements
@element cosmoz-image-viewer
@demo demo/index.html
-->

<dom-module id="cosmoz-image-viewer">
	<template>
		<style include="iron-flex iron-flex-alignment">
			:host {
				display: block;
				position: relative;
				@apply --layout-vertical;
			}
			/* For Polymer 2 */
			[hidden] {
				display: none !important;
			}

			#imageContainer {
				overflow-y: auto;
				will-change: transform;
			}

			.actions {
				position: absolute;
				left: 0;
				right: 0;
				margin: 12px;
			}

			.nav.counter {
				position: absolute;
				left: calc(50% - 32px);
				margin-top: 22px;
				width: 40px;
				padding: 4px 10px;
    			border-radius: 30px;
				text-align: center;
				font-weight: 100;
				font-size: 1em;
			}

			.nav {
				z-index: +1;
				opacity: 0.5;
				color:rgba(255, 255, 255, 0.87);
				opacity: 1;
				background-color: rgba(0, 0, 0, 0.44);
				border-radius: 20px;
				margin: 3px;
			}

			#carousel {
				--skeleton-carousel-item-selected: {
					height: auto;
					text-align: center;
				};

				--skeleton-carousel-item: {
					height: 0;
					text-align: center;
				};

				--skeleton-carousel-nav: {
					background-color: rgba(0, 0, 0, 0.44);
					color: rgba(255, 255, 255, 0.87);
					top: 12px;
					position: absolute;
				};

				--skeleton-carousel-nav-disabled: {
					/* otherwise fullscreen gets triggerd on tap */
					pointer-events: all !important;
				};

				--skeleton-carousel-nav-next: {
					left: 56px;
				};

				--skeleton-carousel-nav-prev: {
					left: 12px;
				};

				--skeleton-carousel-controls: {
					padding: 0;
				}
			}

			.image {
				background-color: gray;
				pointer-events: none;
				--iron-image-width: 100%;
				--iron-image-height: auto;
				@apply --cosmoz-image-viewer-image;
			}

			.image-zoom {
				@apply --layout-flex-auto;
				display: flex;
				justify-content: center;
				background-color: black;
				pointer-events: none;
				height: 100vh;
				@apply --cosmoz-image-viewer-image-zoom;
			}

		</style>

		<div class="nav counter" hidden$="[[!_showPageNumber]]">
			[[selectedImageNumber]]/[[total]]
		</div>

		<div class="actions layout horizontal center">
			<paper-icon-button
				class="nav"
				hidden$="[[!_showNav]]"
				icon="icons:arrow-back"
				on-tap="previousImage">
			</paper-icon-button>
			<paper-icon-button
				class="nav"
				hidden$="[[!_showNav]]"
				icon="icons:arrow-forward"
				on-tap="nextImage">
			</paper-icon-button>
			<div class="flex"></div>
			<paper-icon-button
				class="nav"
				hidden$="[[!_showZoom]]"
				on-click="zoomToggle"
				icon="[[_getZoomIcon(isZoomed)]]"
				title="[[ _('Zoom image', t) ]]">
			</paper-icon-button>
			<paper-icon-button
				class="nav"
				hidden$="[[!_showDetach]]"
				on-click="detach"
				icon="launch"
				title="[[ _('Detach image to separate window', t) ]]">
			</paper-icon-button>
			<paper-icon-button
				class="nav"
				hidden$="[[!_showFullscreen]]"
				on-click="openFullscreen"
				icon="icons:fullscreen"
				title="[[ _('Fullscreen image', t) ]]">
			</paper-icon-button>
			<paper-icon-button
				class="nav"
				hidden$="[[!showClose]]"
				on-click="_close"
				icon="icons:close"
				title="[[ _('Close fullscreen', t) ]]">
			</paper-icon-button>
		</div>

		<div id="imageContainer" on-scroll="_scrollHandler">
			<p hidden$="[[_hideNoImageInfo]]">[[ _('No image loaded.', t) ]]</p>
			<skeleton-carousel id="carousel"
				selected-item="{{selectedItem}}"
				dots="[[showDots]]"
				loop="[[loop]]"
				total="{{total}}"
				selected="{{currentImageIndex}}">
				<template is="dom-repeat" items="[[_resolvedImages]]" as="image">
					<div>
						<img-pan-zoom hidden$="[[!showZoom]]"
							class="image-zoom"
							data-src$="[[image]]"
							on-loaded-changed="_imageLoadedChanged">
						</img-pan-zoom>
						<iron-image hidden$="[[showZoom]]"
							sizing="[[sizing]]"
							class="image"
							data-src$="[[image]]"
							on-loaded-changed="_imageLoadedChanged">
						</iron-image>
					</div>
				</template>
			</skeleton-carousel>
		</div>
	</template>
	<script type="text/javascript" src="cosmoz-image-viewer.js"></script>
</dom-module>
