<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<title>cosmoz-image-viewer basic test</title>

	<script src="/components/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
	<script src="/components/mocha/mocha.js"></script>
	<script src="/components/wct-mocha/wct-mocha.js"></script>
	<script src="/components/chai/chai.js"></script>
	<script src="/components/sinon/pkg/sinon.js"></script>
	<script src="/components/@polymer/test-fixture/test-fixture-mocha.js"></script>

	<script type="module" src="/components/@polymer/test-fixture/test-fixture.js"></script>
	<script type="module" src="/components/@polymer/iron-test-helpers/iron-test-helpers.js"></script>

	<script type="module" src="../cosmoz-image-viewer.js"></script>
</head>
<body>
	<test-fixture id="cosmozImageViewer">
		<template>
			<cosmoz-image-viewer show-zoom></cosmoz-image-viewer>
		</template>
		</test-fixture>

		<test-fixture id="cosmozImageViewer2">
						<template>
								<cosmoz-image-viewer show-zoom></cosmoz-image-viewer>
						</template>
				</test-fixture>

	<script type="module">
		import { Base } from '@polymer/polymer/polymer-legacy';

		sinon.assert.expose(chai.assert, { prefix: '' });
		const createImageViewer = name => {
			const el = fixture(name);

			el.images = [
				'../demo/images/stockholm.jpg',
				'../demo/images/strasbourg.jpg',
				'../demo/images/cosmos1.jpg'
			];

			return el;
		};

		suite('cosmoz-image-viewer', () => {
			let imageViewer;

			setup(function (done) {
				imageViewer = createImageViewer('cosmozImageViewer');

				const w = imageViewer.detach();
				if (w == null) {
					/* eslint-disable-next-line no-console */
					console.warn('Only gets tested without popup blocker');
					/* eslint-disable-next-line no-invalid-this */
					this.skip();
				}
				w.close();

				Base.async(() => {
					done();
				}, 100);
			});

			teardown(() => {
				imageViewer.window.close();
			});

			test('detaching works', () => {
				const w = imageViewer.detach();
				assert.isNotNull(w);
			});

			test('detaching to existing window works', () => {
				const w = imageViewer.detach(),
					w2 = imageViewer.detach();
				assert.isNotNull(w);
				assert.deepEqual(w, w2);
			});

			test('shared detaching works', () => {
				const imageViewer2 = createImageViewer('cosmozImageViewer2'),
					w = imageViewer.detach(),
					w2 = imageViewer2.detach();
				assert.isNotNull(w);
				assert.deepEqual(w, w2);
			});

			test('detach from fullscreen works', () => {
				assert.isFalse(imageViewer.hidden);
				assert.isFalse(imageViewer.hasWindow);

				imageViewer.openFullscreen();
				assert.isFalse(imageViewer.hasWindow);

				const ov = document.querySelector('cosmoz-image-viewer-overlay');

				ov.shadowRoot.querySelector('cosmoz-image-viewer').detach();
				assert.isTrue(imageViewer.hasWindow);
				assert.isTrue(imageViewer.hidden);
			});
		});
	</script>
</body>
</html>
